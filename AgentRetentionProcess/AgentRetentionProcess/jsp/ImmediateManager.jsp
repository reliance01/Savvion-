<%--  This JSP has been generated by using from xsl version 9.0 at Wed Mar 09 17:53:22 IST 2022 --%>
<!DOCTYPE html>
<html xmlns:sbm="http://www.savvion.com/sbm" xmlns:bizsolo="http://www.savvion.com/sbm/BizSolo" xmlns:jsp="http://java.sun.com/JSP/Page" xmlns:xalan="http://xml.apache.org/xalan" xmlns:fn="http://www.w3.org/2005/02/xpath-functions" xmlns:sfe="http://www.savvion.com/sbm/sfe" xmlns:c="http://java.sun.com/jsp/jstl/core">
<head><META http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge">

<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page import="com.savvion.BizSolo.Server.*,com.savvion.BizSolo.beans.*,com.savvion.sbm.util.DatabaseMapping,java.util.Vector,java.util.Locale" %>
<%@ page import="com.savvion.sbm.bizsolo.util.session.*,java.net.*" %>
<%@ page errorPage="/BizSolo/common/jsp/expcontroller.jsp" %>
<%@ taglib uri="/BizSolo/common/tlds/bizsolo.tld" prefix="bizsolo" %>
<%@ taglib uri="/bpmportal/tld/bpmportal.tld" prefix="sbm" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt" %>
<%@ taglib prefix="form" tagdir="/WEB-INF/tags/form"%>
<%@ taglib prefix="sfe" uri="http://jmaki/v1.0/jsp" %>
  <jsp:useBean id="bizManage" class="com.savvion.sbm.bizmanage.api.BizManageBean" scope="session"></jsp:useBean>
  <jsp:useBean id="bean" class="com.savvion.BizSolo.beans.Bean" scope="session"></jsp:useBean>
  <jsp:useBean id="factoryBean" class="com.savvion.BizSolo.beans.EPFactoryBean" scope="session"></jsp:useBean>
  <jsp:useBean id="bizSite" class="com.savvion.sbm.bpmportal.bizsite.api.BizSiteBean" scope="session"></jsp:useBean>
<%! String _PageName = "ImmediateManager"; %>
<%! String __webAppName = "AgentRetentionProcess"; %>
<% pageContext.setAttribute( "contextPath", request.getContextPath()+"/"); %>
<% pageContext.setAttribute( "maxMultiLineLength", DatabaseMapping.self().getSQLSize(java.lang.String.class));  %>
<%java.util.List<String> priorities = com.savvion.sbm.bpmportal.util.PortalUtil.self().getPriorities();%>
<% pageContext.setAttribute( "_priorities",priorities); %>
<bizsolo:if test='<%=_PageName.equals(request.getParameter("_PageName")) %>'>
    <bizsolo:setDS name="bmRemark,immediateManagerRemarks,isImmediateManagerCall,agent_code"></bizsolo:setDS>
    <bizsolo:choose>
<bizsolo:when test='<%=request.getParameter("bizsite_reassignTask") !=null %>'>
      <bizsolo:initDS name="performer" param="bizsite_assigneeName" hexval="FALSE"></bizsolo:initDS>
      <bizsolo:executeAction epClassName="com.savvion.BizSolo.beans.PAKReassignWI" perfMethod="commit" mode="BizSite" dsi="" dso="immediateManagerRemarks,agent_code,isImmediateManagerCall,bmRemark"></bizsolo:executeAction>
</bizsolo:when>
<bizsolo:when test='<%=request.getParameter("bizsite_saveTask") !=null %>'>
      <bizsolo:executeAction epClassName="com.savvion.BizSolo.beans.PAKUpdateDS" perfMethod="commit" mode="BizSite" dsi="immediateManagerRemarks,agent_code,isImmediateManagerCall,bmRemark"></bizsolo:executeAction>
</bizsolo:when>
    <bizsolo:otherwise>
      <bizsolo:executeAction epClassName="com.savvion.BizSolo.beans.PAKSetDS" perfMethod="commit" mode="BizSite" dsi="immediateManagerRemarks,agent_code,isImmediateManagerCall,bmRemark" res=""></bizsolo:executeAction>
      </bizsolo:otherwise>
    </bizsolo:choose>
<% /* Workaround, retAddr will disappear in the future */ %>
<% String retAddr = bean.getPropString("returnPage"); %>
<% if(retAddr != null) { %>
<bizsolo:redirectURL page="<%= retAddr %>"/>
<% } %>
</bizsolo:if>
<bizsolo:if test='<%= ! _PageName.equals(request.getParameter("_PageName")) %>'>
    <bizsolo:initApp mode="BizSite" name="AgentRetentionProcess"></bizsolo:initApp>
<bizsolo:initDS name="bmRemark" type="STRING"></bizsolo:initDS>
<bizsolo:initDS name="immediateManagerRemarks" type="STRING"></bizsolo:initDS>
<bizsolo:initDS name="isImmediateManagerCall" type="STRING"></bizsolo:initDS>
<bizsolo:initDS name="agent_code" type="STRING"></bizsolo:initDS>
    <bizsolo:executeAction epClassName="com.savvion.BizSolo.beans.PAKGetDS" perfMethod="commit" mode="BizSite" dso="immediateManagerRemarks,agent_code,isImmediateManagerCall,bmRemark"></bizsolo:executeAction>
</bizsolo:if>

<title>ImmediateManager</title>
<%boolean isStandaloneBS = (bizManage == null || bizManage.getName() == null || "".equals(bizManage.getName()) || bizManage.getLocale() == null);Locale myLocale = (!isStandaloneBS) ? bizManage.getLocale() : request.getLocale();%>
<!-- Javascript -->
<script language="JavaScript"> var getLocalizedString = parent.getLocalizedString; </script>
<form:includes contextPath="${contextPath}"/>
<script language="JavaScript">
     
      var isIFrame = <%= (PublicResources.INTERACTIVE_MODE.equalsIgnoreCase(bean.getPropString(PublicResources.MODE)) || PublicResources.SLAVE_MODE.equalsIgnoreCase(bean.getPropString(PublicResources.MODE))) ? true : false %>;
      

    function getContextPath(){
        return "<%=request.getContextPath()%>";
    }
</script>


<sbm:setLocale value="<%= bizManage.getLocale() %>"></sbm:setLocale>
<% try{ %><sbm:setBundle scope="page" basename="AgentRetentionProcess/properties/AgentRetentionProcess"></sbm:setBundle><% } catch(Exception e){}%>
<bizsolo:getApplicationResources baseName="AgentRetentionProcess/properties/AgentRetentionProcess"/></head>
<body class="apbody yui-skin-sam" onLoad="setCheckBoxStyleForIE();hideControls();beforeInitControls();initControls();initTabs();sbm.utils.onDOMReady();">
<form method="post" name="form" onsubmit="return sbm.utils.onFormSubmit();">
<div id="northDiv" style="height:0px;display:none;"><bizsolo:xsrf/></div><% /* Workaround, activityName will disappear in the future */ %>
<% String activityName = bean.getPropString("workitemName"); %>
<div id="resultDiv">
<div style='visibility:hidden;display:none' class='vBoxClass' name='errors' id='errors'></div>
<input name="_PageName" type="hidden" value="ImmediateManager">
<%if(bean.getPropString("workitemName") != null) {%><input name="_WorkitemName" type="hidden" value="<%= URLHexCoder.encode(bean.getPropString("workitemName")) %>"/><input name="_WorkitemId" type="hidden" value="<%= bean.getPropLong("workitemId") %>"/><%}%>
<input name="bizsite_pagetype" type="hidden" value="activity">
<input name="_ProcessTemplateName" type="hidden" value='<%=bean.getPropString("ptName")%>'>
<input name="_yahoo_flow_button" type="hidden" value=''>
<!-- Content --> 

    
      <%@ page import="com.savvion.sbm.bizlogic.server.ejb.BLServer" %>

<%@ page import="com.savvion.sbm.bizlogic.client.BLClientUtil" %>

<%@ page import="com.savvion.sbm.bizlogic.util.Session" %>

<%@ page import="com.savvion.sbm.bizlogic.server.svo.ProcessInstance" %>

<script language="JavaScript" src="scripts/jquery-1.11.1.js"></script>

<script language="JavaScript" src="scripts/jquery-ui.min.js"></script>

<script language="JavaScript" src="scripts/jquery.multiselect.js"></script>

<script language="JavaScript" src="scripts/custom.js"></script>

<link rel="stylesheet" type="text/css" href="style/custom.css" />

<link rel="stylesheet" type="text/css" href="style/jquery-ui.css" />

<link rel="stylesheet" type="text/css" href="style/jquery.multiselect.css" />

<%

BLServer blServer = BLClientUtil.getBizLogicServer(); 

Session blSession = bizSite.getBizlogicSession();

long piID = Long.parseLong(activityName.split("::")[0].split("#")[1].trim());

ProcessInstance pi = blServer.getProcessInstance(blSession, piID);

%>

<%!

    String checkNull(String val)

    {

       if(val != null && val.trim().length() > 0)

       {

           return val.trim();

       }

       else

       {

          return "";

       }

    }

%>

<div class="header">Immediate Manager Resolution</div>

<div>


      <table class="agentDtl">
        <tr>
          <td class="fieldName" colspan='6' style='text-align:center;padding-top:5px;padding-bottom:5px;'>AGENT DETAIL</td>
        </tr>
        <tr>
           <td class="fieldName">Agent Code</td>
           <td class="fieldValue"><%= checkNull((String)pi.getDataSlotValue("agent_code")).split("-")[0] %></td>
           <td class="fieldName">Agent Name</td>
           <td class="fieldValue"><%= checkNull((String)pi.getDataSlotValue("agent_code")).split("-")[1] %></td>
           <td class="fieldName">SM Status</td>
           <td class="fieldValue"><%= checkNull((String)pi.getDataSlotValue("sm_status")) %></td>
        </tr>
        <tr>
           <td class="fieldName">SM Name</td>
           <td class="fieldValue"><%= checkNull((String)pi.getDataSlotValue("sm_name")) %></td>
           <td class="fieldName">SM Code</td>
           <td class="fieldValue"><%= checkNull((String)pi.getDataSlotValue("sm_code")) %></td>
           <td class="fieldName">Branch Code</td>
           <td class="fieldValue"><%= checkNull((String)pi.getDataSlotValue("branch_code")) %></td>
        </tr>
        <tr>
           <td class="fieldName">Branch Name</td>
           <td class="fieldValue"><%= checkNull((String)pi.getDataSlotValue("branch_name")) %></td>
	<td class="fieldName">Unique Reference Number</td>
           <td class="fieldValue"><%= Long.parseLong(activityName.split("::")[0].split("#")[1].trim()) %></td>
        </tr>
       
   </table>

</div>

<table id = 'bmTable' class="agentDtl">
	<thead>
        <tr>
            <th class="fieldName" colspan='10' style="text-align:center;padding-top:5px;padding-bottom:5px;">Immediate Manager Resolution Details</th>
        </tr>
        <tr>
              <th class="fieldName"  style="width: 2%;text-align:center;">Sr. No.</th>
      	      <th class="fieldName" >BM Remark</th>
              <th class="fieldName" style="width: 3.2%;text-align:center;">BM Sumbit Date</th>
	      <th class="fieldName" > Remark</th>
              <th class="fieldName" style="width: 3.2%;text-align:center;">Submit Date</th>
     
        </tr>
       </thead>

       <tbody id = 'bmTable_body'>
       </tbody>
   </table>


    <table class='agentDtl'>
        <tr>
           
            <td class="fieldName"  style='width:5%; text-align:left; padding-right:10px;'>Remarks</td>
           <td class="fieldValue" >
             <textarea id='bmRmk' rows='2' cols='55' disabled=true ><%= checkNull((String)pi.getDataSlotValue("bmRemark")) %></textarea>
 		<td class="fieldName"  style='width:5%; text-align:right; padding-right:10px;'>Immediate Manager Remark</td>
           <td class="fieldValue" >
             <textarea id='managerRmk' rows='2' cols='55' maxlength='500'></textarea>
		</td>
        </tr>
      
        <tr>
          <td class='fieldName' colspan='6' style='text-align:center;padding-top:10px;'>
             <image src='images/submit.png' height='30' width='100' style='cursor:pointer;' onClick='saveDetail();' />
          </td>
       </tr>
    </table>

<div style="display : none">

    <br clear="all">
<Label class="ApSegDataslotLabel" id="" for="textField1"><sbm:message key="dataslot.ImmediateManager.bmRemark.label"></sbm:message></Label>
    <sfe:widget name="sbm.textfield" id="bmRemark" args="{'type':'text', 'size':20, 'maxlength':500, 'readonly':false, 'visible':true, 'disabled':false, 'validationType':'none', 'validation':{}, 'toolTip':'Savvion textfield widget', 'tabOrder':'0'}" />

    <br clear="all">
<Label class="ApSegDataslotLabel" id="" for="textField2"><sbm:message key="dataslot.ImmediateManager.immediateManagerRemarks.label"></sbm:message></Label>
    <sfe:widget name="sbm.textfield" id="immediateManagerRemark" args="{'type':'text', 'size':20, 'maxlength':500, 'readonly':false, 'visible':true, 'disabled':false, 'validationType':'none', 'validation':{}, 'toolTip':'Savvion textfield widget', 'tabOrder':'0'}" />

    <br clear="all">
<Label class="ApSegDataslotLabel" id="" for="textField1"><sbm:message key="dataslot.ImmediateManager.isImmediateManagerCall.label"></sbm:message></Label>
    <sfe:widget name="sbm.textfield" id="isImmediateManagerCall" args="{'type':'text', 'size':20, 'maxlength':20, 'readonly':false, 'visible':true, 'disabled':false, 'validationType':'none', 'validation':{}, 'toolTip':'Savvion textfield widget', 'tabOrder':'0'}" />

    <br clear="all">
<br clear="all">
<Label class="ApSegDataslotLabel" id="" for="textField1"><sbm:message key="dataslot.ImmediateManager.agent_code.label"></sbm:message></Label>
    <sfe:widget name="sbm.textfield" id="agent_code" args="{'type':'text', 'size':20, 'maxlength':50, 'readonly':false, 'visible':true, 'disabled':false, 'validationType':'none', 'validation':{}, 'toolTip':'Savvion textfield widget', 'tabOrder':'0'}" />

    <br clear="all">
<br clear="all">
<input class="ApScrnButton" name="bizsite_completeTask" id="completeButton" type="submit" tabindex="0" value="<bizsolo:getLabel name='COMPLETE_LABEL' type='RESOURCE'/>" onMouseOut="this.className='ApScrnButton';" onMouseOver="this.className='ApScrnButtonHover';" onClick="clickedButton=this.name;this.onsubmit = new Function('return false');">

    <br clear="all">
</div>
    <br clear="all">

  
                    <div id="resizablepanel" style="display:none">
                        <div class="hd">Alert Dialog</div>
                        <div class="bd"></div>
                        <div class="ft"></div>
                    </div> 
<div id="southDiv" style="height:0px;display:none;"></div></form>
</body>

<script language="JavaScript">
<!--
function beforeInitControls() {
}
-->
</script>
<script language="JavaScript">
<!--
function userValidationJavascript() {
return true;
}
-->
</script>
<sbm:dataSources appName="AgentRetentionProcess" appType="bizlogic">
</sbm:dataSources>
<script language="JavaScript">
<!--
$(document).ready(function(){



var piid = <%=activityName.split("::")[0].split("#")[1]%>;


   pwr.getRemarks(piid,getRemarksCallback);


})

function getRemarksCallback(value)

{


var row = value.length;

for(var i=0 ; i < row ; i++ )

{



var abc = value[i];



var count = document.getElementById("bmTable_body").rows.length;

var newHtml="";

count++;



newHtml+="<tr>";

newHtml+="<td class=\"fieldValue\" style=\"width: 2%; text-align:center;\">"+count+"</td>";


newHtml+="<td class=\"fieldValue\" style=\" text-align:center;\" >"+abc["BM_REMARKS"]+"</td>";

newHtml+="<td class=\"fieldValue\" style=\"width: 3.2%; text-align:center;\">"+abc["BM_SUBMIT_DATE"]+"</td>";


var spocRmk = abc["IMMEDIATEMANAGER_REMARKS"];
if(spocRmk == 'Pending')
{
spocRmk = '-';
}

newHtml+="<td class=\"fieldValue\" style=\" text-align:center;\">"+spocRmk+"</td>";

var spocDate = abc["IM_SUBMIT_DATE"];
if(spocDate == 'N/A')
{
spocDate = '-';
}

newHtml+="<td class=\"fieldValue\" style=\"width: 3.2%; text-align:center;\">"+spocDate+"</td>";

newHtml+="</tr>";

var div = document.getElementById('bmTable_body');

div.innerHTML = div.innerHTML + newHtml;

}

}



function saveDetail()

{

 

var remark = $('#managerRmk').val();

if(remark.trim() == '')

{

alert("Please Fill Your Remarks !!!");

}

else

{



$('#immediateManagerRemark').val(remark);

$('#isImmediateManagerCall').val('0');

$('#completeButton').click();

}





};
-->
</script>
<!--Initialize extensible widgets.-->
<script language="JavaScript">
<!--
var _dateFormats = {date:'<%=bean.getPropString(PublicResources.JS_CALENDAR_DATE_FORMAT)%>', dateOnly:'<%=bean.getPropString(PublicResources.JS_CALENDAR_DATE_ONLY_FORMAT)%>'};

var allWidgets = [{widget:'bmRemark', bound:'true', editable:'true', type:'sbm.textfield', source: {type:'DATASLOT', dataSlotName:'bmRemark', dataSlotType:'STRING'}, target:{type:'DATASLOT', dataSlotName:'bmRemark', dataSlotType:'STRING'}, dsType:'STRING', service:'false'},
{widget:'immediateManagerRemark', bound:'true', editable:'true', type:'sbm.textfield', source: {type:'DATASLOT', dataSlotName:'immediateManagerRemarks', dataSlotType:'STRING'}, target:{type:'DATASLOT', dataSlotName:'immediateManagerRemarks', dataSlotType:'STRING'}, dsType:'STRING', service:'false'},
{widget:'isImmediateManagerCall', bound:'true', editable:'true', type:'sbm.textfield', source: {type:'DATASLOT', dataSlotName:'isImmediateManagerCall', dataSlotType:'STRING'}, target:{type:'DATASLOT', dataSlotName:'isImmediateManagerCall', dataSlotType:'STRING'}, dsType:'STRING', service:'false'},
{widget:'agent_code', bound:'true', editable:'true', type:'sbm.textfield', source: {type:'DATASLOT', dataSlotName:'agent_code', dataSlotType:'STRING'}, target:{type:'DATASLOT', dataSlotName:'agent_code', dataSlotType:'STRING'}, dsType:'STRING', service:'false'}
];
var businessObjects = [];
var formWidgetHandler;

sbm.utils.onDOMReady = function() {
YAHOO.util.Event.onDOMReady(function(){
formWidgetHandler = new FormWidgetHandler(allWidgets,null,{processName:'AgentRetentionProcess',processType:'bizlogic',maxMultiLineLength:${maxMultiLineLength},adapletCache:{'user':''}},'<%=request.getParameter(BizSoloRequest.BSS_FIID)%>');
 });
 }
Ext.onReady(function(){
 var task = new Ext.util.DelayedTask(function(){
});
  task.delay(500);
  var viewport = new Bm.util.BmViewport('',{resultComponentXtype:'container'});

});

   
    scrollToErrors = function() {
        var errorsDiv = document.getElementById('errors');
        if(errorsDiv !== null) {
            errorsDiv.scrollIntoView();
        }
    }
    sbm.utils.onFormSubmit = function() {
        if(!formWidgetHandler.validateWidgets()) {
            scrollToErrors();
            return false;
        }
        try{
            if(!userValidationJavascript()) {
                scrollToErrors();
                return false;
            }              
            sbm.utils.handleFormSubmit();
        }catch(e){
            scrollToErrors();
            return false;
        }

                            document.form.action='<%=response.encodeURL("ImmediateManager.jsp")%>';
         if(allWidgets.length > 0)formWidgetHandler.saveDataSlots();
         return true;
}
-->
</script>

</html>